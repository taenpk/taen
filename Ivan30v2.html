<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–≤–µ—Å—Ç –¥–ª—è –ò–≤–∞–Ω–∞: Level 30</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º React –∏ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Babel –¥–ª—è —Ä–∞–±–æ—Ç—ã JSX –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { margin: 0; background-color: #111827; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.4s ease-in-out;
        }
        .animate-fade-in {
            animation: fadeIn 1s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- –ò–∫–æ–Ω–∫–∏ ---
        const IconBase = ({ children, className, size = 24 }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const ArrowRight = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
        const Skull = (props) => <IconBase {...props}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const Music = (props) => <IconBase {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;

        // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –î–∞–Ω–Ω—ã–µ ---

        const FRIENDS = ["–õ–µ—Ö–∏", "–î–∏–º–æ–Ω–∞", "–°–µ—Ä—ë–≥–∏"]; 

        const CLASSES = {
            MAGE: {
                id: 'mage',
                name: '–í–µ—Ä—Ö–æ–≤–Ω—ã–π –ú–∞–≥',
                description: '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª, –Ω–æ –º–æ–∂–µ—Ç –∏ —Å –ø—Ä–∞–≤–æ–π –ø—Ä–æ–±–∏—Ç—å.',
                emoji: 'üßô‚Äç‚ôÇÔ∏è',
                hp: 100,
                maxHp: 100,
                charges: 1, 
                chargeName: '–ú–∞–Ω–∞',
                abilities: {
                    special: { name: '–û–≥–Ω–µ–Ω–Ω—ã–π –®–∞—Ä', dmg: 65, desc: '–ò—Å–ø–µ–ø–µ–ª—è–µ—Ç –≤—Ä–∞–≥–æ–≤ (–û—Å—Ç–∞–ª—Å—è 1 –∑–∞—Ä—è–¥!)' },
                    melee1: { name: '–£–¥–∞—Ä –ø–æ—Å–æ—Ö–æ–º –ø–æ –Ω–æ–≥–∞–º', dmg: 15, desc: '–ü–æ–¥–ª–æ, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ' },
                    melee2: { name: '–ü—Ä–∞–≤—ã–π —Ö—É–∫', dmg: 20, desc: '–ö–æ–≥–¥–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–Ω—á–∏–ª–∏—Å—å' }
                }
            },
            WARRIOR: {
                id: 'warrior',
                name: '–°–≤–∏—Ä–µ–ø—ã–π –í–æ–∏–Ω',
                description: '–°–∏–ª–∞ –µ—Å—Ç—å, —É–º–∞ –Ω–µ –Ω–∞–¥–æ. –ú–µ—á –Ω–∞–¥–µ–∂–Ω—ã–π... –ø–æ—á—Ç–∏.',
                emoji: '‚öîÔ∏è',
                hp: 100, 
                maxHp: 100,
                charges: 2, 
                chargeName: '–ü—Ä–æ—á–Ω–æ—Å—Ç—å –º–µ—á–∞',
                abilities: {
                    special: { name: '–†–∞—Å—Å–µ–∫–∞—é—â–∏–π —É–¥–∞—Ä', dmg: 40, desc: '–≠–ø–∏—á–Ω—ã–π –≤–∑–º–∞—Ö –º–µ—á–æ–º' },
                    melee1: { name: '–ö–æ–ª–µ–Ω–æ–º –≤ —á–µ–ª—é—Å—Ç—å', dmg: 25, desc: '–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –ø—Ä–∏–µ–º' },
                    melee2: { name: '–ù–∞ "–∫–æ–ª–≥–∞–Ω"', dmg: 30, desc: '–ì–æ–ª–æ–≤–æ–π —Å —Ä–∞–∑–º–∞—Ö—É' }
                }
            },
            HUNTER: {
                id: 'hunter',
                name: '–û—Ö–æ—Ç–Ω–∏–∫ —Å –î–≤—É—Å—Ç–≤–æ–ª–∫–æ–π',
                description: '–°—Ç—Ä–µ–ª—è–µ—Ç –º–µ—Ç–∫–æ, –Ω–æ –ø–∞—Ç—Ä–æ–Ω—ã –¥–æ—Ä–æ–≥–∏–µ.',
                emoji: 'ü§†',
                hp: 90, 
                maxHp: 90,
                charges: 2, 
                chargeName: '–ü–∞—Ç—Ä–æ–Ω—ã',
                abilities: {
                    special: { name: '–î—É–ø–ª–µ—Ç', dmg: 45, desc: '–ë–∞–±–∞—Ö! –î—Ä–æ–±—å –ª–µ—Ç–∏—Ç –≤–æ –≤—Ä–∞–≥–∞' },
                    melee1: { name: '–ü—Ä–∏–∫–ª–∞–¥–æ–º –≤ –∑—É–±—ã', dmg: 20, desc: '–¢—è–∂–µ–ª—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç' },
                    melee2: { name: '–£–¥–∞—Ä —Å –≤–µ—Ä—Ç—É—à–∫–∏', dmg: 15, desc: '–°—Ç–∏–ª—å –ß–∞–∫–∞ –ù–æ—Ä—Ä–∏—Å–∞' }
                }
            }
        };

        const QUESTIONS = [
            {
                text: "–ò–≤–∞–Ω, –ø–æ–º–Ω–∏—à—å –ø—Ä–æ—à–ª—É—é –ø—è—Ç–Ω–∏—Ü—É? –ì–¥–µ –º—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –î–∏–º–æ–Ω–∞?",
                options: ["–í –∫–∞—Ä–∞–æ–∫–µ, –ø–µ–ª –õ–µ–ø—Å–∞", "–£—Å–Ω—É–ª –≤ —Ç–∞–∫—Å–∏ –∏ —É–µ—Ö–∞–ª –≤ –¢–≤–µ—Ä—å", "–°—Ä–∞–∂–∞–ª—Å—è —Å –≥–æ–ª—É–±–µ–º –≤ –ø–∞—Ä–∫–µ"],
                correct: 0,
                story: "–¢–æ—á–Ω–æ! –î–∏–º–æ–Ω —Ç–æ–≥–¥–∞ –≤—ã–¥–∞–ª —Å–æ–ª–æ –Ω–∞ —Å—Ç–æ–ª–µ. –ù–æ —ç—Ç–æ –±—ã–ª–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ –ø—É—Ç–∏..."
            },
            {
                text: "–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞—à–µ–π —Ç—É—Å–æ–≤–∫–∏:",
                options: ["–ö—Ç–æ –Ω–µ –ø—å–µ—Ç, —Ç–æ—Ç —à–ø–∏–æ–Ω", "–°–Ω–∞—á–∞–ª–∞ —Ç–æ—Ä—Ç, –ø–æ—Ç–æ–º –≤–µ—Å–µ–ª—å–µ", "–ß—Ç–æ –±—ã–ª–æ –≤ –í–µ–≥–∞—Å–µ, –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –í–µ–≥–∞—Å–µ"],
                correct: 2,
                story: "–ò–º–µ–Ω–Ω–æ. –ò —Ç–æ, —á—Ç–æ —Å–µ–π—á–∞—Å –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, —Ç–æ–∂–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–∞–º–∏."
            },
            {
                text: "–ö–æ–≥–¥–∞ –ò–≤–∞–Ω —Å—Ç–∞–Ω–µ—Ç –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–º –º–∏—Ä–∞, –∫–∞–∫–æ–π –±—É–¥–µ—Ç –µ–≥–æ –ø–µ—Ä–≤—ã–π —É–∫–∞–∑?",
                options: ["–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø–∏–≤–æ –ø–æ –ø—è—Ç–Ω–∏—Ü–∞–º", "–ó–∞–ø—Ä–µ—Ç–∏—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ 12:00", "–ö–∞–∂–¥–æ–º—É –ø–æ –ª–∏—á–Ω–æ–º—É –≤–µ—Ä—Ç–æ–ª–µ—Ç—É"],
                correct: 1,
                story: "–ù–∞—Ä–æ–¥ –ª–∏–∫—É–µ—Ç! –ù–æ —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–æ–±–µ–¥–∏—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –≤—Ä–∞–≥–∞..."
            }
        ];

        // --- –û—Å–Ω–æ–≤–Ω–æ–π –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ---

        function App() {
            const [stage, setStage] = useState('welcome'); 
            const [heroClass, setHeroClass] = useState(null);
            const [heroStats, setHeroStats] = useState({ hp: 100, charges: 0 });
            const [bossStats, setBossStats] = useState({ hp: 160, maxHp: 160 });
            const [questIndex, setQuestIndex] = useState(0);
            const [battleLog, setBattleLog] = useState(["–ú–æ–Ω—Å—Ç—Ä –ø–æ—è–≤–∏–ª—Å—è!"]);
            const [isPlayerTurn, setIsPlayerTurn] = useState(true);
            const [shake, setShake] = useState(false);

            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [battleLog]);

            const resetGame = () => {
                setStage('welcome');
                setHeroClass(null);
                setQuestIndex(0);
                setBattleLog(["–ú–æ–Ω—Å—Ç—Ä –ø–æ—è–≤–∏–ª—Å—è!"]);
                setIsPlayerTurn(true);
                setBossStats({ hp: 160, maxHp: 160 });
            };

            const selectClass = (key) => {
                const selected = CLASSES[key];
                setHeroClass(selected);
                setHeroStats({ hp: selected.hp, charges: selected.charges });
                setStage('quest');
            };

            const handleAnswer = () => {
                if (questIndex < QUESTIONS.length - 1) {
                    setQuestIndex(questIndex + 1);
                } else {
                    setStage('battle');
                }
            };

            const playerAttack = (type) => {
                if (!isPlayerTurn) return;

                let damage = 0;
                let logMsg = "";
                let useCharge = false;

                const abilities = heroClass.abilities;

                if (type === 'special') {
                    if (heroStats.charges > 0) {
                        damage = abilities.special.dmg + Math.floor(Math.random() * 10);
                        logMsg = `–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å ${abilities.special.name}! –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω ${damage}!`;
                        useCharge = true;
                    } else {
                        logMsg = "–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å! –°–∏–ª –±–æ–ª—å—à–µ –Ω–µ—Ç.";
                    }
                } else if (type === 'melee1') {
                    damage = abilities.melee1.dmg + Math.floor(Math.random() * 5);
                    logMsg = `–¢—ã –ø—Ä–æ–≤–æ–¥–∏—à—å ${abilities.melee1.name}. –ù–∞–Ω–µ—Å–µ–Ω–æ ${damage} —É—Ä–æ–Ω–∞.`;
                } else if (type === 'melee2') {
                    damage = abilities.melee2.dmg + Math.floor(Math.random() * 5);
                    logMsg = `–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å ${abilities.melee2.name}. –ù–∞–Ω–µ—Å–µ–Ω–æ ${damage} —É—Ä–æ–Ω–∞.`;
                }

                if (useCharge) {
                    setHeroStats(prev => ({ ...prev, charges: prev.charges - 1 }));
                    if (heroStats.charges - 1 === 0) {
                        if (heroClass.id === 'warrior') logMsg += " –ú–ï–ß –°–õ–û–ú–ê–õ–°–Ø!";
                        if (heroClass.id === 'hunter') logMsg += " –ü–ê–¢–†–û–ù–´ –ö–û–ù–ß–ò–õ–ò–°–¨!";
                        if (heroClass.id === 'mage') logMsg += " –ú–ê–ù–ê –ò–°–°–Ø–ö–õ–ê!";
                    }
                }

                const newBossHp = Math.max(0, bossStats.hp - damage);
                setBossStats(prev => ({ ...prev, hp: newBossHp }));
                setBattleLog(prev => [...prev, logMsg]);

                if (newBossHp === 0) {
                    setTimeout(() => setStage('victory'), 1500);
                } else {
                    setIsPlayerTurn(false);
                    setTimeout(bossTurn, 1500);
                }
            };

            const bossTurn = () => {
                const bossDamage = 15 + Math.floor(Math.random() * 20); 
                const phrases = [
                    "–ö—Ä–∏–∑–∏—Å 30 –ª–µ—Ç –±—å–µ—Ç –ø–æ –±–æ–ª—å–Ω–æ–π —Å–ø–∏–Ω–µ!",
                    "–ú–æ–Ω—Å—Ç—Ä –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø—Ä–æ –∏–ø–æ—Ç–µ–∫—É!",
                    "–ë–æ—Å—Å –∫–∏–¥–∞–µ—Ç –≤ —Ç–µ–±—è –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏!",
                    "–ú–æ–Ω—Å—Ç—Ä –æ—Ä–µ—Ç: '–ê —á–∞—Å–∏–∫–∏-—Ç–æ —Ç–∏–∫–∞—é—Ç!'",
                    "–£–¥–∞—Ä –≤–∑—Ä–æ—Å–ª–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é!",
                    "–ü—Ä–∏—à–ª–∏ —Å—á–µ—Ç–∞ –∑–∞ –∫–æ–º–º—É–Ω–∞–ª–∫—É!",
                    "–ë–æ—Å—Å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: '–ê –≥–¥–µ –≤–Ω—É–∫–∏?'",
                    "–°–ø–∏–Ω–∞ –∑–∞–±–æ–ª–µ–ª–∞ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫!",
                    "–¶–µ–Ω—ã –Ω–∞ –±–µ–Ω–∑–∏–Ω —Å–Ω–æ–≤–∞ –≤—ã—Ä–æ—Å–ª–∏!",
                    "–°–æ—Å–µ–¥ —Å–≤–µ—Ä—Ö—É –∑–∞—Ç–µ—è–ª —Ä–µ–º–æ–Ω—Ç –≤ 8 —É—Ç—Ä–∞!"
                ];
                const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –ø—Ä–µ–≤—ã—à–∞–ª –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –∑–¥–æ—Ä–æ–≤—å–µ - 1
                let actualDamage = bossDamage;
                if (heroStats.hp - bossDamage <= 0) {
                    actualDamage = Math.max(0, heroStats.hp - 1);
                }

                setHeroStats(prev => ({ ...prev, hp: prev.hp - actualDamage }));

                let logMessage = `${randomPhrase} (-${actualDamage} HP)`;
                if (actualDamage === 0) {
                    logMessage = `${randomPhrase} (–ü–†–û–ú–ê–•! –¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è!)`;
                }

                setBattleLog(prev => [...prev, logMessage]);
                setShake(true);
                setTimeout(() => setShake(false), 500);
                setIsPlayerTurn(true);
            };

            // --- –†–µ–Ω–¥–µ—Ä –°—Ü–µ–Ω ---

            const renderWelcome = () => (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 text-center space-y-8 animate-fade-in">
                    <div className="relative">
                        <div className="absolute -top-10 -left-10 text-6xl animate-bounce">üéâ</div>
                        <div className="absolute -top-10 -right-10 text-6xl animate-bounce delay-100">üéÇ</div>
                        <h1 className="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 drop-shadow-lg">
                            –ò–í–ê–ù <br/> LEVEL 30
                        </h1>
                    </div>
                    <p className="text-xl text-gray-300 max-w-md">
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏. –°–µ–≥–æ–¥–Ω—è —Ç—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—à—å –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
                    </p>
                    <button 
                        onClick={() => setStage('select')}
                        className="px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full text-xl font-bold hover:scale-105 transition-transform shadow-xl shadow-purple-500/20 flex items-center gap-2 text-white"
                    >
                        –ù–∞—á–∞—Ç—å –ö–≤–µ—Å—Ç <ArrowRight />
                    </button>
                </div>
            );

            const renderSelect = () => (
                <div className="flex flex-col items-center justify-center min-h-screen p-4">
                    <h2 className="text-3xl font-bold mb-8 text-white">–ö—Ç–æ —Ç—ã —Å–µ–≥–æ–¥–Ω—è?</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl">
                        {Object.keys(CLASSES).map((key) => {
                            const cls = CLASSES[key];
                            return (
                                <div 
                                    key={key}
                                    onClick={() => selectClass(key)}
                                    className="bg-gray-800/80 backdrop-blur-md border border-gray-700 p-6 rounded-2xl cursor-pointer hover:border-purple-500 hover:bg-gray-700/80 transition-all transform hover:-translate-y-2 group"
                                >
                                    <div className="text-6xl mb-4 group-hover:scale-110 transition-transform">{cls.emoji}</div>
                                    <h3 className="text-2xl font-bold text-white mb-2">{cls.name}</h3>
                                    <p className="text-gray-400 mb-4 h-12">{cls.description}</p>
                                    <div className="flex justify-between text-sm text-gray-300 bg-gray-900 p-3 rounded-lg">
                                        <span className="flex items-center gap-1"><Heart className="w-4 h-4 text-red-500"/> {cls.hp} HP</span>
                                        <span className="flex items-center gap-1"><Zap className="w-4 h-4 text-yellow-500"/> –ê—Ç–∞–∫–∞</span>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            );

            const renderQuest = () => (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 max-w-2xl mx-auto">
                    <div className="bg-gray-800/90 p-8 rounded-3xl border border-gray-600 shadow-2xl w-full">
                        <div className="flex items-center gap-3 mb-6">
                            <div className="w-12 h-12 rounded-full bg-purple-600 flex items-center justify-center text-2xl">
                                {heroClass.emoji}
                            </div>
                            <div>
                                <h3 className="text-xl font-bold text-white">–ò—Å—Ç–æ—Ä–∏—è –æ—Ç {FRIENDS[questIndex % FRIENDS.length]}</h3>
                                <span className="text-xs text-gray-400">–£—Ä–æ–≤–µ–Ω—å {questIndex + 1}</span>
                            </div>
                        </div>
                        
                        <p className="text-xl text-white mb-8 leading-relaxed">
                            {QUESTIONS[questIndex].text}
                        </p>

                        <div className="space-y-3">
                            {QUESTIONS[questIndex].options.map((opt, i) => (
                                <button
                                    key={i}
                                    onClick={handleAnswer}
                                    className="w-full text-left p-4 rounded-xl bg-gray-700 hover:bg-purple-600 text-white transition-colors border border-gray-600 hover:border-purple-400"
                                >
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const renderBattle = () => {
                const canUseSpecial = heroStats.charges > 0;
                const isLowHp = heroStats.hp < (heroClass.maxHp * 0.3);

                return (
                    <div className={`flex flex-col items-center min-h-screen p-4 pt-10 max-w-lg mx-auto ${shake ? 'animate-shake' : ''}`}>
                        <div className="w-full bg-red-900/30 rounded-2xl p-6 mb-4 border border-red-500/30 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-2 opacity-20 text-white">
                                <Skull size={100} />
                            </div>
                            <div className="flex justify-between items-center mb-2">
                                <h3 className="text-2xl font-black text-red-400">–ö–†–ò–ó–ò–° 30 –õ–ï–¢</h3>
                                <span className="text-red-300 font-mono">{bossStats.hp}/{bossStats.maxHp} HP</span>
                            </div>
                            <div className="w-full bg-gray-700 h-4 rounded-full overflow-hidden">
                                <div 
                                    className="bg-red-500 h-full transition-all duration-500" 
                                    style={{ width: `${(bossStats.hp / bossStats.maxHp) * 100}%` }}
                                ></div>
                            </div>
                            <div className="mt-4 flex justify-center">
                                <div className="text-8xl animate-pulse">üêâ</div>
                            </div>
                        </div>

                        <div className="w-full h-32 bg-black/50 rounded-xl p-4 mb-4 overflow-y-auto text-sm space-y-1 font-mono border border-gray-700">
                            {battleLog.map((log, i) => (
                                <div key={i} className={i === battleLog.length - 1 ? "text-yellow-400 font-bold" : "text-gray-400"}>
                                    {">"} {log}
                                </div>
                            ))}
                            <div ref={messagesEndRef} />
                        </div>

                        <div className={`w-full bg-blue-900/30 rounded-2xl p-6 border transition-colors ${isLowHp ? 'border-red-500 animate-pulse' : 'border-blue-500/30'}`}>
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-2">
                                    <span className="text-4xl">{heroClass.emoji}</span>
                                    <div>
                                        <h3 className="font-bold text-white">{heroClass.name}</h3>
                                        <div className="text-xs text-blue-300 flex items-center gap-1">
                                            {heroClass.charges > 0 ? (
                                                <span className="text-green-400">{heroClass.chargeName}: {heroStats.charges}</span>
                                            ) : (
                                                <span className="text-red-400 font-bold uppercase">–†–ï–°–£–†–° –ò–°–ß–ï–†–ü–ê–ù!</span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <span className={`font-mono text-xl ${isLowHp ? 'text-red-500 font-black' : 'text-white'}`}>
                                        {heroStats.hp}/{heroClass.maxHp} HP
                                    </span>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 gap-3">
                                {canUseSpecial ? (
                                    <button 
                                        onClick={() => playerAttack('special')}
                                        disabled={!isPlayerTurn}
                                        className="w-full py-4 bg-gradient-to-r from-yellow-500 to-red-600 rounded-xl font-bold text-white shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2"
                                    >
                                        <Zap /> {heroClass.abilities.special.name} <span className="text-xs bg-black/20 px-2 py-1 rounded">DMG: {heroClass.abilities.special.dmg}</span>
                                    </button>
                                ) : (
                                    <div className="grid grid-cols-2 gap-3">
                                        <button 
                                            onClick={() => playerAttack('melee1')}
                                            disabled={!isPlayerTurn}
                                            className="py-4 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold text-white active:scale-95 transition-all border-b-4 border-gray-900"
                                        >
                                            {heroClass.abilities.melee1.name}
                                        </button>
                                        <button 
                                            onClick={() => playerAttack('melee2')}
                                            disabled={!isPlayerTurn}
                                            className="py-4 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold text-white active:scale-95 transition-all border-b-4 border-gray-900"
                                        >
                                            {heroClass.abilities.melee2.name}
                                        </button>
                                    </div>
                                )}
                                
                                <div className="text-center text-xs text-gray-500 mt-2">
                                    {!canUseSpecial && "–û—Å–Ω–æ–≤–Ω–æ–µ –æ—Ä—É–∂–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ! –í —Ö–æ–¥ –∏–¥—É—Ç –≥—Ä—è–∑–Ω—ã–µ –ø—Ä–∏–µ–º—ã."}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderVictory = () => (
                <div className="flex flex-col items-center justify-center min-h-screen p-6 text-center animate-fade-in bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]">
                    <div className="mb-8 relative">
                        <div className="absolute inset-0 animate-ping opacity-75 rounded-full bg-yellow-500"></div>
                        <Trophy size={80} className="text-yellow-400 relative z-10" />
                    </div>
                    
                    <h1 className="text-4xl md:text-6xl font-black text-white mb-4">–ü–û–ë–ï–î–ê!</h1>
                    <p className="text-xl text-gray-300 mb-8 max-w-lg">
                        –ò–≤–∞–Ω, —Ç—ã –æ–¥–æ–ª–µ–ª –∫—Ä–∏–∑–∏—Å 30 –ª–µ—Ç! –í–ø–µ—Ä–µ–¥–∏ —Ç–æ–ª—å–∫–æ –ª—É—á—à–∏–µ –≥–æ–¥—ã, –ª—É—Ç –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –º–∞–Ω–∞ (–∏ –¥–µ–Ω—å–≥–∏).
                    </p>
                    
                    <div className="bg-gray-800 p-6 rounded-2xl border border-purple-500/50 shadow-2xl shadow-purple-500/20 max-w-md w-full mb-8">
                        <h3 className="text-xl font-bold text-purple-300 mb-4">–¢–≤–æ–π –ì–ª–∞–≤–Ω—ã–π –õ—É—Ç:</h3>
                        <a 
                            href="https://music.yandex.ru/album/2822763/track/24225052" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            className="flex items-center justify-center gap-3 w-full py-6 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white rounded-xl font-bold text-2xl shadow-lg transform hover:-translate-y-1 transition-all animate-pulse"
                        >
                            <Music size={28} />
                            –ù–ê–ñ–ú–ò –ú–ï–ù–Ø
                        </a>
                        <p className="text-gray-400 text-sm mt-4">
                            (–í–∫–ª—é—á–∞–π –º—É–∑—ã–∫—É –∏ –≥–æ—Ç–æ–≤—å—Å—è –∫ –≤–µ—á–µ—Ä–∏–Ω–∫–µ!)
                        </p>
                    </div>

                    <button
                        onClick={resetGame}
                        className="flex items-center gap-2 text-gray-400 hover:text-white transition-colors"
                    >
                        <RotateCcw size={18} />
                        –í –Ω–∞—á–∞–ª–æ
                    </button>

                    <div className="mt-8 flex gap-4 text-4xl animate-bounce">
                        <span>üéà</span><span>üéÅ</span><span>ü•Ç</span>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-900 text-white font-sans selection:bg-purple-500 selection:text-white overflow-x-hidden">
                    {stage === 'welcome' && renderWelcome()}
                    {stage === 'select' && renderSelect()}
                    {stage === 'quest' && renderQuest()}
                    {stage === 'battle' && renderBattle()}
                    {stage === 'victory' && renderVictory()}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>