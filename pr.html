<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–° –Æ–±–∏–ª–µ–µ–º, –ú–∞—Ä–∏–Ω–∞!</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∏–∫–æ–Ω–∫–∏ Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* –ß—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–∫—Ä–æ–ª–ª–∞ */
            touch-action: manipulation; /* –£–ª—É—á—à–∞–µ—Ç —Ç–∞—á –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ—Ç —Å–∏–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ iOS */
        }
        
        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob { animation: blob 7s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }

        @keyframes shimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        .animate-shimmer {
            background-size: 200% auto;
            animation: shimmer 3s linear infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .animate-wiggle { animation: wiggle 1s ease-in-out infinite; }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.8s ease-out forwards; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }

        /* Typewriter Cursor */
        @keyframes blink {
            0%, 100% { border-color: transparent; }
            50% { border-color: rgba(255,255,255,0.7); }
        }
        .typewriter-cursor {
            border-right: 3px solid rgba(255,255,255,0.7);
            animation: blink 0.75s step-end infinite;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .photo-card {
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            transform-origin: center bottom;
        }
        
        .photo-card.swiped {
            transform: translate(100vw, -20deg) rotate(45deg) !important;
            opacity: 0 !important;
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —Å–µ–∫—Ü–∏–∏ */
        .step-section {
            display: none;
            width: 100%;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .step-section.active {
            display: flex;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–≤–∏–∑–∞ */
        .quiz-option {
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            transform: translateY(-2px);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã —Å–ª–∞–π–¥–∞ –∫–∞—Ä—É—Å–µ–ª–∏ */
        .fade-enter {
            animation: fade-in 0.5s ease-out forwards;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-800">

    <!-- –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ö–ù–û–ü–ö–ê –ó–í–£–ö–ê (–í–∏–¥–Ω–∞ –≤–µ–∑–¥–µ) -->
    <button id="btn-sound" class="fixed top-4 right-4 z-[100] p-3 bg-white/20 backdrop-blur-md border border-white/10 rounded-full shadow-lg text-white hover:bg-white/30 transition-all hover:scale-110 group active:scale-95">
        <i id="icon-sound-on" data-lucide="volume-2" class="w-6 h-6 group-hover:text-yellow-200 transition-colors"></i>
        <i id="icon-sound-off" data-lucide="volume-x" class="w-6 h-6 hidden text-slate-400"></i>
    </button>

    <!-- 1. –≠–ö–†–ê–ù –ü–ê–†–û–õ–Ø -->
    <div id="step-password" class="step-section active flex-col items-center justify-center bg-slate-900 text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 animate-pulse"></div>
        <div class="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-purple-600 rounded-full blur-[120px] opacity-40 animate-blob"></div>
        
        <div class="bg-white/5 backdrop-blur-xl border border-white/10 p-8 rounded-3xl shadow-2xl max-w-sm w-full text-center animate-fade-in-up z-10 m-4">
            <div class="mb-6 flex justify-center">
                <div class="p-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full shadow-lg shadow-purple-500/30">
                    <i data-lucide="lock" class="w-8 h-8 text-white"></i>
                </div>
            </div>
            <h2 class="text-xl font-light mb-6 tracking-widest uppercase text-purple-200">–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∞–∑–¥–Ω–∏–∫—É</h2>
            <form id="password-form" class="space-y-6">
                <input
                    id="password-input"
                    type="password"
                    inputmode="numeric" 
                    maxlength="4"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    class="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-4 text-center text-3xl tracking-[1em] focus:outline-none focus:border-pink-500 transition-all text-white placeholder:text-white/20"
                />
                <button
                    type="submit"
                    class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-purple-900/50 transform hover:scale-[1.02] active:scale-95"
                >
                    –û–¢–ö–†–´–¢–¨
                </button>
            </form>
            <div id="preload-status" class="mt-4 text-xs text-white/30 font-light">
                –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∞–≥–∏–∏...
            </div>
        </div>
    </div>

    <!-- 2. –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –≠–ö–†–ê–ù -->
    <div id="step-welcome" class="step-section flex-col items-center justify-center bg-gradient-to-b from-slate-50 to-pink-50 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
            <div class="absolute top-[10%] left-[10%] w-64 h-64 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-40 animate-blob"></div>
            <div class="absolute top-[10%] right-[10%] w-64 h-64 bg-yellow-200 rounded-full mix-blend-multiply filter blur-3xl opacity-40 animate-blob animation-delay-2000"></div>
            <div class="absolute bottom-[10%] left-[30%] w-80 h-80 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-40 animate-blob animation-delay-4000"></div>
        </div>

        <div class="relative z-10 text-center p-6 md:p-8 max-w-md animate-fade-in flex flex-col items-center w-full">
            <div class="mb-6 inline-block p-3 rounded-full bg-white shadow-md">
                <i data-lucide="sparkles" class="w-8 h-8 text-yellow-500 animate-pulse"></i>
            </div>
            <h1 class="text-4xl md:text-6xl font-serif text-slate-800 mb-6 leading-tight">
                –û—Å–æ–±–µ–Ω–Ω—ã–π –¥–µ–Ω—å <br />
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-500 to-purple-600 animate-shimmer">
                    –ú–∞—Ä–∏–Ω—ã
                </span>
            </h1>
            
            <div class="relative mb-12">
                <p class="text-lg md:text-xl font-serif italic leading-relaxed text-transparent bg-clip-text bg-gradient-to-r from-slate-600 via-purple-700 to-slate-600">
                    "–≠—Ç–æ –∏—Å—Ç–æ—Ä–∏—è –æ –ª—é–±–≤–∏, –∫—Ä–∞—Å–æ—Ç–µ –∏ –º–≥–Ω–æ–≤–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≥—Ä–µ–≤–∞—é—Ç —Å–µ—Ä–¥—Ü–µ. <br/>–¢–≤–æ–π –ª–∏—á–Ω—ã–π –º–∏—Ä –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π."
                </p>
                <div class="absolute -bottom-4 left-1/2 -translate-x-1/2 w-16 h-1 bg-gradient-to-r from-transparent via-pink-300 to-transparent rounded-full"></div>
            </div>
            
            <button
                id="btn-start-journey"
                class="group relative inline-flex items-center justify-center px-10 py-5 font-bold text-white transition-all duration-200 bg-slate-900 font-lg rounded-full focus:outline-none hover:scale-105 active:scale-95 shadow-2xl hover:shadow-purple-500/20"
            >
                <span>–î–ª—è –¢–µ–±—è</span>
                <i data-lucide="heart" class="ml-3 w-5 h-5 text-pink-500 fill-pink-500 group-hover:animate-ping"></i>
            </button>
        </div>
    </div>

    <!-- 3. –ö–í–ò–ó -->
    <div id="step-quiz" class="step-section flex-col items-center justify-center bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 relative overflow-hidden px-4">
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
            <div class="absolute bottom-10 right-10 w-96 h-96 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
            <div class="absolute top-20 left-10 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        </div>

        <div class="relative z-10 w-full max-w-lg">
            <div id="quiz-header" class="text-center mb-6 md:mb-8 animate-fade-in-up">
                <h2 class="text-3xl md:text-4xl font-serif font-bold text-slate-800 mb-2">–ú–∏–Ω–∏-–ø—Ä–æ–≤–µ—Ä–∫–∞</h2>
                <p class="text-slate-500 text-sm md:text-base">–ù–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ —Ç—ã –ø–æ–º–Ω–∏—à—å –Ω–∞—à–∏ –º–æ–º–µ–Ω—Ç—ã? üíõ</p>
            </div>

            <div id="quiz-card" class="bg-white/70 backdrop-blur-xl border border-white/50 p-6 md:p-8 rounded-3xl shadow-xl transition-all duration-300 animate-fade-in-up">
                <!-- –°—é–¥–∞ JS –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã -->
            </div>
        </div>
    </div>

    <!-- 4. –ì–ê–õ–ï–†–ï–Ø -->
    <div id="step-gallery" class="step-section flex-col items-center justify-center bg-slate-50 relative overflow-hidden px-4">
        
        <!-- –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –®–ö–ê–õ–ê –ü–†–û–ì–†–ï–°–°–ê -->
        <!-- 
           Mobile: top-20, horizontal (h-2 w-64), flex-row
           Desktop (md): left-10, vertical (h-64 w-2), flex-col
        -->
        <div class="absolute 
            top-24 left-1/2 -translate-x-1/2 w-64 h-2 
            md:top-1/2 md:left-10 md:translate-x-0 md:-translate-y-1/2 md:h-64 md:w-2
            bg-slate-200 rounded-full flex 
            flex-row md:flex-col 
            justify-start md:justify-end items-center z-20">
            
            <div 
                id="progress-bar"
                class="bg-gradient-to-r md:bg-gradient-to-t from-purple-600 via-pink-500 to-orange-400 rounded-full transition-all duration-700 ease-out shadow-[0_0_10px_rgba(236,72,153,0.5)]"
                style="height: 0%; width: 0%;" 
            ></div>
            
            <!-- –ó–≤–µ–∑–¥–∞ -->
            <div class="absolute -right-8 md:right-auto md:-bottom-8 text-purple-600">
                <i id="progress-star" data-lucide="star" class="w-6 h-6"></i>
            </div>
            
            <!-- –ù–∞–¥–ø–∏—Å—å 2025 -->
            <div id="label-2025" class="absolute -left-12 md:left-auto md:-top-10 font-bold transition-all duration-500 text-slate-300 text-sm md:text-base">
                2025
            </div>
        </div>

        <div class="relative w-full max-w-sm aspect-[3/4] flex items-center justify-center mt-8 md:mt-0">
            
            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (—Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç ID –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è) -->
            <div id="gallery-instruction" class="absolute inset-0 flex items-center justify-center text-slate-400 text-sm animate-pulse z-0 font-medium tracking-wide pointer-events-none">
                <div class="bg-white/50 backdrop-blur-sm px-4 py-2 rounded-full">
                    üëÜ –ö–û–°–ù–ò–°–¨ –§–û–¢–û
                </div>
            </div>

            <div id="cards-container" class="relative w-full h-full cursor-pointer perspective-1000">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>

            <div id="gallery-finish" class="hidden flex-col items-center justify-center w-full h-full animate-fade-in-up text-center z-10 relative">
                <div class="mb-8 bg-white/80 backdrop-blur-md p-8 rounded-[2rem] shadow-xl border border-pink-100 max-w-xs relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-20 h-20 bg-yellow-200 rounded-full blur-2xl opacity-50"></div>
                    <div class="absolute -bottom-10 -left-10 w-20 h-20 bg-purple-200 rounded-full blur-2xl opacity-50"></div>
                    <p class="font-serif text-2xl text-slate-800 italic leading-snug">
                        "–í—Å—ë —Å–∞–º–æ–µ –ª—É—á—à–µ–µ <br/>—Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è..."
                    </p>
                </div>
                
                <button
                    id="btn-to-celebration"
                    class="group relative bg-white text-slate-800 p-6 rounded-full shadow-2xl transition-all hover:scale-110 active:scale-95"
                >
                    <div class="absolute inset-0 bg-gradient-to-r from-red-500 via-pink-500 to-purple-500 rounded-full animate-spin-slow opacity-70 blur-md group-hover:opacity-100"></div>
                    <div class="relative bg-white rounded-full p-4 group-hover:bg-slate-50">
                        <i data-lucide="gift" class="w-12 h-12 text-pink-500 animate-wiggle"></i>
                    </div>
                </button>
                <span class="mt-6 text-slate-500 text-sm font-medium tracking-widest uppercase animate-pulse">–ù–∞–∂–º–∏ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫</span>
            </div>
        </div>
    </div>

    <!-- 5. –§–ò–ù–ê–õ (–°–ê–õ–Æ–¢) -->
    <div id="step-celebration" class="step-section flex-col items-center justify-center bg-slate-900 overflow-hidden text-center px-4 relative">
        <!-- Canvas –¥–ª—è —Å–∞–ª—é—Ç–∞ -->
        <canvas id="fireworks-canvas" class="absolute inset-0 z-0 pointer-events-none"></canvas>
        
        <!-- –ö–ù–û–ü–ö–ê "–í –ù–ê–ß–ê–õ–û" -->
        <button id="btn-restart" class="absolute top-4 left-4 z-50 p-3 bg-white/10 backdrop-blur-md rounded-full text-white/70 hover:text-white hover:bg-white/20 transition-all hover:scale-105 group active:scale-95" title="–í –Ω–∞—á–∞–ª–æ">
            <div class="flex items-center gap-2">
                <i data-lucide="rotate-ccw" class="w-5 h-5 group-hover:-rotate-90 transition-transform duration-500"></i>
                <span class="text-sm font-medium pr-1 hidden md:inline-block">–í –Ω–∞—á–∞–ª–æ</span>
            </div>
        </button>

        <!-- –§–æ–Ω–æ–≤—ã–µ –æ–≥–Ω–∏ -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-r from-purple-900 to-pink-900 rounded-full mix-blend-screen filter blur-[120px] opacity-30 animate-pulse"></div>

        <div class="relative z-10 max-w-3xl w-full flex flex-col items-center pt-16 pb-20 overflow-y-auto max-h-screen no-scrollbar">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="mb-8 animate-fade-in-up relative flex-shrink-0 mt-8">
                <i data-lucide="star" class="absolute -top-12 -right-8 w-12 h-12 text-yellow-400 animate-spin-slow opacity-80"></i>
                <i data-lucide="star" class="absolute -bottom-4 -left-10 w-8 h-8 text-pink-400 animate-pulse opacity-80"></i>
                
                <h1 class="text-5xl md:text-8xl font-bold font-serif leading-none tracking-tight">
                    <span class="block text-white mb-2 drop-shadow-[0_5px_5px_rgba(0,0,0,0.5)]">–ú–∞—Ä–∏–Ω–∞</span>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-200 animate-shimmer">
                        50 –õ–ï–¢
                    </span>
                </h1>
            </div>

            <!-- 1) –ö–ê–†–¢–û–ß–ö–ê TYPEWRITER (–ú–∞–≥–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ) -->
            <div class="bg-white/10 backdrop-blur-lg border border-white/20 p-6 md:p-8 rounded-3xl shadow-2xl mb-8 mx-4 w-full max-w-lg animate-fade-in-up flex-shrink-0 min-h-[160px] flex items-center justify-center" style="animation-delay: 0.3s;">
                <p id="typewriter-text" class="text-lg md:text-2xl text-purple-50 leading-relaxed font-light font-serif italic typewriter-cursor">
                    <!-- –¢–µ–∫—Å—Ç –±—É–¥–µ—Ç –ø–µ—á–∞—Ç–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </p>
            </div>

            <!-- 2) –ö–ê–†–£–°–ï–õ–¨ –ü–û–ñ–ï–õ–ê–ù–ò–ô -->
            <div class="w-full max-w-lg mb-8 animate-fade-in-up px-2" style="animation-delay: 0.5s;">
                <div class="text-center mb-4">
                    <h3 class="text-base md:text-lg font-medium text-pink-200 uppercase tracking-widest">–°–ª–æ–≤–∞ –æ—Ç –±–ª–∏–∑–∫–∏—Ö</h3>
                </div>
                
                <div class="bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl p-2 flex items-center gap-2">
                    <!-- –ö–Ω–æ–ø–∫–∞ –í–ª–µ–≤–æ -->
                    <button id="carousel-prev" class="p-3 md:p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors active:scale-95">
                        <i data-lucide="chevron-left" class="w-6 h-6"></i>
                    </button>
                    
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ö–∞—Ä—É—Å–µ–ª–∏ -->
                    <div id="carousel-content" class="flex-1 text-center py-4 px-2 min-h-[140px] flex flex-col items-center justify-center transition-all duration-300">
                        <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç —ç—Ç–æ -->
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –í–ø—Ä–∞–≤–æ -->
                    <button id="carousel-next" class="p-3 md:p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors active:scale-95">
                        <i data-lucide="chevron-right" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <!-- 3) –¢–ê–ô–ù–´–ô –ü–û–î–ê–†–û–ö -->
            <a 
                href="#" 
                id="secret-gift-btn"
                class="group relative inline-flex items-center gap-3 bg-gradient-to-r from-amber-400 to-orange-500 hover:from-amber-500 hover:to-orange-600 text-white font-bold py-5 px-10 rounded-full shadow-[0_0_40px_rgba(245,158,11,0.4)] transition-all transform hover:-translate-y-1 overflow-hidden animate-fade-in-up flex-shrink-0"
                style="animation-delay: 0.7s;"
            >
                <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/30 to-transparent -translate-x-full group-hover:animate-shine"></div>
                <i data-lucide="sparkles" class="w-6 h-6 fill-white"></i>
                <span class="text-lg uppercase tracking-wide">–¢–∞–π–Ω—ã–π –ü–æ–¥–∞—Ä–æ–∫</span>
                <i data-lucide="chevron-right" class="w-6 h-6 group-hover:translate-x-1 transition-transform"></i>
            </a>
            <!-- –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ -->
            <div class="h-20"></div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
        lucide.createIcons();

        // --- –î–ê–ù–ù–´–ï –° –ú–ò–õ–´–ú–ò –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–Ø–ú–ò (–ì–ê–õ–ï–†–ï–Ø) ---
        const photos = [
            { id: 1, color: 'from-amber-100 to-orange-100', url: 'https://lh3.googleusercontent.com/d/1l6sHPZ5h1EK1fKnxTlPC3mVAgIoMUeI_=s1000?authuser=0', text: '–°–∞–º–æ–π –æ—á–∞—Ä–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π ‚ú®' },
            { id: 2, color: 'from-orange-100 to-red-100', url: 'https://lh3.googleusercontent.com/d/1ENzTUw9xgDhG0PRPqSHXjia96js8ZeYA=s1000?authuser=0', text: '–°–∞–º–æ–π –¥–æ–±—Ä–æ–π üíñ' },
            { id: 3, color: 'from-blue-100 to-indigo-100', url: 'https://lh3.googleusercontent.com/d/1RUcmE8zekLly68zqKmWPJxtSYddN9IXW=s1000?authuser=0', text: '–°–∞–º–æ–π –º—É–¥—Ä–æ–π üåü' },
            { id: 4, color: 'from-pink-100 to-rose-100', url: 'https://lh3.googleusercontent.com/d/1nHKoJVFhGwZN1Dpp-xS20jErTCzcI0h4=s1000?authuser=0', text: '–°–∞–º–æ–π –ª—É—á–µ–∑–∞—Ä–Ω–æ–π ‚òÄÔ∏è' },
            { id: 5, color: 'from-purple-100 to-fuchsia-100', url: 'https://lh3.googleusercontent.com/d/1nNTyG4v-FbOXCjYJtx81ZsYi3TgdHD6M=s1000?authuser=0', text: '–°–∞–º–æ–π –ª—é–±–∏–º–æ–π ‚ù§Ô∏è' },
            { id: 6, color: 'from-emerald-100 to-teal-100', url: 'https://lh3.googleusercontent.com/d/1-AwGqe3KNGD_Rb-mORTXR3GBVWoZBMmo=s1000?authuser=0', text: '–°–∞–º–æ–π –Ω–µ–ø–æ–≤—Ç–æ—Ä–∏–º–æ–π üåπ' },
        ];

        // --- –î–ê–ù–ù–´–ï –î–õ–Ø –ö–í–ò–ó–ê ---
        const quizQuestions = [
            {
                id: 1,
                from: "–ú–∞–º—ã",
                text: "–ö–∞–∫–æ–µ –±–ª—é–¥–æ —è –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤–∏–ª–∞ —Ç–µ–±–µ –≤ –¥–µ—Ç—Å—Ç–≤–µ –Ω–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏?",
                options: ["–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Ç–æ—Ä—Ç", "–û–ª–∏–≤—å–µ –ø–æ-—Ñ–∏—Ä–º–µ–Ω–Ω–æ–º—É", "–ó–∞–ø–µ—á–µ–Ω–Ω—É—é –∫—É—Ä–æ—á–∫—É", "–ü–∏—Ä–æ–∂–∫–∏ —Å –∫–∞–ø—É—Å—Ç–æ–π"],
                correctIndex: 1
            },
            {
                id: 2,
                from: "–ü–æ–¥—Ä—É–≥",
                text: "–ö—É–¥–∞ –º—ã —Å —Ç–æ–±–æ–π —á–∞—â–µ –≤—Å–µ–≥–æ –º–µ—á—Ç–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ?",
                options: ["–í –≥–æ—Ä—ã –Ω–∞ –ª—ã–∂–∏", "–í –ü–∞—Ä–∏–∂ –Ω–∞ —à–æ–ø–∏–Ω–≥", "–ù–∞ –º–æ—Ä–µ –ø–æ–¥ –ø–∞–ª—å–º—ã", "–í –∫—Ä—É–≥–æ—Å–≤–µ—Ç–∫—É"],
                correctIndex: 2
            },
            {
                id: 3,
                from: "–ö–æ–ª–ª–µ–≥",
                text: "–ö–∞–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤ —Ç–µ–±–µ –º—ã —Ü–µ–Ω–∏–º –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
                options: ["–°—Ç—Ä–æ–≥–æ—Å—Ç—å", "–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –æ–ø—Ç–∏–º–∏–∑–º", "–õ—é–±–æ–≤—å –∫ –æ—Ç—á–µ—Ç–∞–º", "–£–º–µ–Ω–∏–µ –≤–∞—Ä–∏—Ç—å –∫–æ—Ñ–µ"],
                correctIndex: 1
            },
            {
                id: 4,
                from: "–°–µ–º—å–∏",
                text: "–ß—Ç–æ –¥–ª—è –Ω–∞—Å –≥–ª–∞–≤–Ω–æ–µ, –∫–æ–≥–¥–∞ –º—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è –≤–º–µ—Å—Ç–µ?",
                options: ["–ü–æ–µ—Å—Ç—å –≤–∫—É—Å–Ω–æ", "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–ª–µ–≤–∏–∑–æ—Ä", "–¢–≤–æ—è —É–ª—ã–±–∫–∞ –∏ —Å–º–µ—Ö", "–¢–∏—à–∏–Ω–∞ –∏ –ø–æ–∫–æ–π"],
                correctIndex: 2
            }
        ];

        // --- –î–ê–ù–ù–´–ï –î–õ–Ø –ö–ê–†–£–°–ï–õ–ò –ü–û–ñ–ï–õ–ê–ù–ò–ô ---
        const wishes = [
            { from: "–ú–∞–º–∞", text: "–ú—ã –æ—á–µ–Ω—å –≥–æ—Ä–¥–∏–º—Å—è —Ç–æ–±–æ–π. –ü—É—Å—Ç—å –≤–ø–µ—Ä–µ–¥–∏ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ —Å—á–∞—Å—Ç—å–µ." },
            { from: "–õ—É—á—à–∏–π –¥—Ä—É–≥", text: "–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–º–µ—Ö, –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –≤—Å–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è. –¢—ã –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫." },
            { from: "–°–µ—Å—Ç—Ä–∞", text: "–¢—ã ‚Äî –ª—É—á—à–∞—è! –ü—É—Å—Ç—å —Ç–≤–æ—è –¥–æ—Ä–æ–≥–∞ –±—É–¥–µ—Ç —è—Ä–∫–æ–π –∏ –ª—ë–≥–∫–æ–π." },
            { from: "–°–µ–º—å—è", text: "–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ä–∞–¥–æ—Å—Ç—å –∏ —Ç–µ–ø–ª–æ!" }
        ];

        let currentIndex = 0; // –î–ª—è –≥–∞–ª–µ—Ä–µ–∏
        let currentQuizIndex = 0; // –î–ª—è –∫–≤–∏–∑–∞
        let quizScore = 0; // –°—á–µ—Ç –∫–≤–∏–∑–∞
        let currentWishIndex = 0; // –î–ª—è –∫–∞—Ä—É—Å–µ–ª–∏
        let isSoundEnabled = true;

        // --- –•–ò–¢–†–ê–Ø –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û ---
        (function preloadImages() {
            const preloadStatus = document.getElementById('preload-status');
            let loadedCount = 0;

            photos.forEach(photo => {
                const img = new Image();
                img.src = photo.url;
                img.referrerPolicy = "no-referrer";
                img.onload = () => {
                    loadedCount++;
                    if(preloadStatus) preloadStatus.textContent = `–ó–∞—Ä—è–∂–µ–Ω–æ —Ñ–æ—Ç–æ: ${loadedCount} –∏–∑ ${photos.length}`;
                };
            });
        })();

        // --- –ê–£–î–ò–û –°–ò–°–¢–ï–ú–ê (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const bufferSize = audioCtx.sampleRate * 2; 
        const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            output[i] = Math.random() * 2 - 1;
        }

        // 1. –ó–≤—É–∫ –ª–∏—Å—Ç–∞–Ω–∏—è (–û–ë–ù–û–í–õ–ï–ù: —Ç–µ–ø–µ—Ä—å —ç—Ç–æ —Ç–∏—Ö–∏–π "–≤–∑–º–∞—Ö –≤–æ–∑–¥—É—Ö–æ–º")
        function playPageTurn() {
            if (!isSoundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            
            // –§–∏–ª—å—Ç—Ä: –Ω–∏–∑–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "—à–∏–ø–µ–Ω–∏—è"
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass'; 
            filter.frequency.setValueAtTime(600, audioCtx.currentTime);
            filter.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2); // –ë—ã—Å—Ç—Ä–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞

            const gain = audioCtx.createGain();
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            
            // –û—á–µ–Ω—å —Ç–∏—Ö–∞—è –∏ –∫–æ—Ä–æ—Ç–∫–∞—è –æ–≥–∏–±–∞—é—â–∞—è
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.04, now + 0.05); // –ï–ª–µ —Å–ª—ã—à–Ω–æ
            gain.gain.linearRampToValueAtTime(0, now + 0.2);

            noise.start(now);
            noise.stop(now + 0.2);
        }

        // 2. –ó–≤—É–∫ —É—Å–ø–µ—Ö–∞ –≤ –∫–≤–∏–∑–µ (–û–ë–ù–û–í–õ–ï–ù: –í–æ–ª—à–µ–±–Ω—ã–π –º–∞–∂–æ—Ä–Ω—ã–π –∞–∫–∫–æ—Ä–¥)
        function playSuccessSound() {
            if (!isSoundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const now = audioCtx.currentTime;

            // –ê–∫–∫–æ—Ä–¥ C Major (–î–æ, –ú–∏, –°–æ–ª—å) –≤—Ç–æ—Ä–æ–π –æ–∫—Ç–∞–≤—ã - –∑–≤—É—á–∏—Ç –º–∞–≥–∏—á–µ—Å–∫–∏
            const frequencies = [523.25, 659.25, 783.99]; 
            
            frequencies.forEach((freq, index) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.type = 'sine'; // –°–∞–º–∞—è –º—è–≥–∫–∞—è –≤–æ–ª–Ω–∞
                osc.frequency.value = freq;
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "–∞—Ä–ø–µ–¥–∂–∏–æ" (–ø–µ—Ä–µ–±–æ—Ä)
                const startTime = now + (index * 0.05);
                
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.05, startTime + 0.05); // –¢–∏—Ö–æ
                gain.gain.exponentialRampToValueAtTime(0.001, startTime + 1.2); // –ü–ª–∞–≤–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
                
                osc.start(startTime);
                osc.stop(startTime + 1.2);
            });
        }

        // 3. –ó–≤—É–∫ —Å–∞–ª—é—Ç–∞ (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª–∏)
        function playFireworkSound() {
            if (!isSoundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400; 
            const gain = audioCtx.createGain();
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            gain.gain.setValueAtTime(0.05, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            noise.start(now);
            noise.stop(now + 1.5);
        }


        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        let fireworksInterval = null;
        let fireworksAnimationFrame = null;

        function showStep(stepId) {
            document.querySelectorAll('.step-section').forEach(el => el.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');
            
            if (stepId === 'step-celebration') {
                startFireworks();
                startTypewriter(); // –ó–∞–ø—É—Å–∫ –ø–µ—á–∞—Ç–∏
                renderWish(); // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—É—Å–µ–ª–∏
            } else {
                stopFireworks();
            }
        }

        // 1. –ü–∞—Ä–æ–ª—å
        document.getElementById('password-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('password-input');
            
            if (input.value === '5555') {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                showStep('step-welcome');
            } else {
                input.classList.add('animate-shake', 'border-red-500');
                input.value = '';
                setTimeout(() => {
                    input.classList.remove('animate-shake', 'border-red-500');
                }, 500);
            }
        });

        // 2. Welcome -> –ö–≤–∏–∑
        document.getElementById('btn-start-journey').addEventListener('click', () => {
            initQuiz();
            showStep('step-quiz');
        });

        // --- –õ–û–ì–ò–ö–ê –ö–í–ò–ó–ê ---
        function initQuiz() {
            currentQuizIndex = 0;
            quizScore = 0;
            document.getElementById('quiz-header').style.display = 'block';
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            const quizContainer = document.getElementById('quiz-card');
            
            if (currentQuizIndex >= quizQuestions.length) {
                renderQuizResult();
                return;
            }

            const q = quizQuestions[currentQuizIndex];
            const progress = `–í–æ–ø—Ä–æ—Å ${currentQuizIndex + 1} –∏–∑ ${quizQuestions.length}`;

            let html = `
                <div class="flex justify-between items-center mb-4 text-sm text-slate-400 font-medium uppercase tracking-wider">
                    <span>${progress}</span>
                    <span class="text-purple-500 bg-purple-100 px-2 py-1 rounded-md">–ë–∞–ª–ª—ã: ${quizScore}</span>
                </div>
                
                <div class="mb-6">
                    <span class="inline-block px-3 py-1 bg-gradient-to-r from-pink-100 to-purple-100 text-purple-700 rounded-full text-xs font-bold mb-3 border border-purple-100">
                        üíå –í–æ–ø—Ä–æ—Å –æ—Ç: ${q.from}
                    </span>
                    <h3 class="text-xl md:text-2xl font-bold text-slate-800 leading-snug">
                        ${q.text}
                    </h3>
                </div>

                <div class="space-y-3">
            `;

            q.options.forEach((opt, idx) => {
                html += `
                    <button 
                        onclick="handleQuizAnswer(${idx}, this)"
                        class="quiz-option w-full text-left p-4 rounded-xl border-2 border-slate-100 text-slate-700 font-medium hover:border-purple-300 hover:bg-purple-50 active:scale-[0.98] flex items-center justify-between group"
                    >
                        <span>${opt}</span>
                        <span class="icon-wrapper">
                            <i data-lucide="circle" class="w-5 h-5 text-slate-300 group-hover:text-purple-400"></i>
                        </span>
                    </button>
                `;
            });

            html += `
                </div>
                <div id="quiz-feedback" class="h-6 mt-3 text-center text-sm font-bold text-red-500 opacity-0 transition-opacity">
                    –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ üîÑ
                </div>
            `;

            quizContainer.innerHTML = html;
            lucide.createIcons();
        }

        function handleQuizAnswer(selectedIndex, btnElement) {
            const q = quizQuestions[currentQuizIndex];
            const feedbackEl = document.getElementById('quiz-feedback');
            const allBtns = document.querySelectorAll('.quiz-option');

            if (selectedIndex === q.correctIndex) {
                // –ü–†–ê–í–ò–õ–¨–ù–û
                playSuccessSound(); // –ù–û–í–´–ô –ó–í–£–ö
                quizScore += 10;
                
                btnElement.classList.remove('border-slate-100', 'text-slate-700', 'hover:bg-purple-50');
                btnElement.classList.add('bg-green-100', 'border-green-500', 'text-green-800', 'shadow-md');
                
                const iconWrapper = btnElement.querySelector('.icon-wrapper');
                if (iconWrapper) {
                    iconWrapper.innerHTML = '<i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>';
                    lucide.createIcons();
                }

                allBtns.forEach(btn => btn.disabled = true);
                
                setTimeout(() => {
                    currentQuizIndex++;
                    renderQuizQuestion();
                }, 800);

            } else {
                // –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
                btnElement.classList.add('animate-shake', 'border-red-400', 'bg-red-50');
                feedbackEl.style.opacity = '1';
                
                setTimeout(() => {
                    btnElement.classList.remove('animate-shake', 'border-red-400', 'bg-red-50');
                    feedbackEl.style.opacity = '0';
                }, 800);
            }
        }

        function renderQuizResult() {
            const quizContainer = document.getElementById('quiz-card');
            const header = document.getElementById('quiz-header');
            
            header.style.display = 'none';

            quizContainer.innerHTML = `
                <div class="text-center py-8">
                    <div class="inline-flex p-4 bg-yellow-100 rounded-full text-yellow-500 mb-6 shadow-sm">
                        <i data-lucide="trophy" class="w-12 h-12 animate-bounce"></i>
                    </div>
                    <h3 class="text-3xl font-serif font-bold text-slate-800 mb-4">–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ!</h3>
                    <p class="text-lg text-slate-600 mb-2">–¢—ã –Ω–∞–±—Ä–∞–ª–∞ <span class="text-purple-600 font-bold text-2xl">${quizScore}</span> –±–∞–ª–ª–æ–≤!</p>
                    <p class="text-slate-500 text-sm mb-8 italic">"–í–æ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ —Ç–µ–±—è –∑–Ω–∞—é—Ç –∏ –ª—é–±—è—Ç!"</p>
                    
                    <button 
                        id="btn-quiz-finish"
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-purple-200 hover:scale-[1.02] transition-transform flex items-center justify-center gap-2"
                    >
                        <span>–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–æ—Ç–æ-–∏—Å—Ç–æ—Ä–∏–∏</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </div>
            `;
            lucide.createIcons();

            document.getElementById('btn-quiz-finish').addEventListener('click', () => {
                renderCards();
                updateProgress();
                showStep('step-gallery');
            });
        }

        // 3. –ì–∞–ª–µ—Ä–µ—è (–õ–æ–≥–∏–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –æ—Å—Ç–∞–ª–∞—Å—å –ø—Ä–µ–∂–Ω–µ–π)
        const cardsContainer = document.getElementById('cards-container');

        function renderCards() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≥–∞–ª–µ—Ä–µ–∏
            const instruction = document.getElementById('gallery-instruction');
            if (instruction) instruction.style.display = 'flex';

            cardsContainer.innerHTML = '';
            photos.slice(currentIndex).forEach((photo, index) => {
                const realIndex = currentIndex + index; 
                const stackOffset = index; 
                
                const card = document.createElement('div');
                card.className = `photo-card absolute inset-0 bg-white p-3 pb-10 shadow-2xl rounded-xl cursor-pointer ring-1 ring-purple-100`;
                
                card.style.zIndex = 50 - stackOffset;
                card.style.transform = `scale(${1 - stackOffset * 0.05}) translateY(${stackOffset * 15}px) rotate(${stackOffset % 2 === 0 ? stackOffset * 2 : -stackOffset * 3}deg)`;
                card.style.filter = stackOffset > 0 ? 'brightness(95%)' : 'brightness(100%)';
                if (stackOffset > 0) card.style.pointerEvents = 'none'; 

                card.innerHTML = `
                    <div class="w-full h-full bg-gradient-to-br ${photo.color} rounded-lg flex flex-col items-center justify-center relative overflow-hidden group">
                        <img 
                            src="${photo.url}" 
                            alt="–§–æ—Ç–æ" 
                            referrerpolicy="no-referrer"
                            class="absolute inset-0 w-full h-full object-cover pointer-events-none"
                            onerror="this.style.display='none'; this.parentElement.innerHTML+='<div class=\'text-slate-400 text-xs p-4 text-center\'>–ó–∞–≥—Ä—É–∑–∫–∞...</div>'"
                        />
                        <div class="absolute inset-0 border border-white/20 rounded-lg pointer-events-none"></div>

                        <div class="absolute bottom-8 left-0 w-full text-center px-4 pointer-events-none z-10">
                            <div class="bg-white/80 backdrop-blur-md py-2 px-4 rounded-full shadow-lg inline-block transform transition-transform duration-500 hover:scale-105">
                                <span class="text-slate-800 font-serif font-medium text-sm whitespace-nowrap">${photo.text}</span>
                            </div>
                        </div>
                    </div>
                `;

                if (stackOffset === 0) {
                    card.onclick = () => {
                        playPageTurn(); 
                        card.classList.add('swiped');
                        setTimeout(() => {
                            currentIndex++;
                            updateProgress();
                            
                            if (currentIndex < photos.length) {
                                renderCards(); 
                            } else {
                                // –§–æ—Ç–æ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å
                                cardsContainer.style.display = 'none';
                                
                                // –°–ö–†–´–í–ê–ï–ú –ò–ù–°–¢–†–£–ö–¶–ò–Æ
                                if (instruction) instruction.style.display = 'none';

                                document.getElementById('gallery-finish').classList.remove('hidden');
                                document.getElementById('gallery-finish').classList.add('flex');
                                document.getElementById('label-2025').classList.remove('text-slate-300');
                                document.getElementById('label-2025').classList.add('text-transparent', 'bg-clip-text', 'bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'scale-125', 'drop-shadow-sm');
                                document.getElementById('progress-star').classList.add('fill-purple-600', 'animate-bounce');
                            }
                        }, 200); 
                    };
                }

                cardsContainer.appendChild(card);
            });
        }

        // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–†–û–ì–†–ï–°–°–ê (–ê–î–ê–ü–¢–ò–í–ù–ê–Ø)
        function updateProgress() {
            const percent = (currentIndex / photos.length) * 100;
            const bar = document.getElementById('progress-bar');
            
            // –ï—Å–ª–∏ —ç–∫—Ä–∞–Ω –º–µ–Ω—å—à–µ 768px (–º–æ–±–∏–ª—å–Ω—ã–π) -> –∑–∞–ø–æ–ª–Ω—è–µ–º —à–∏—Ä–∏–Ω—É
            // –ò–Ω–∞—á–µ (–¥–µ—Å–∫—Ç–æ–ø) -> –∑–∞–ø–æ–ª–Ω—è–µ–º –≤—ã—Å–æ—Ç—É
            if (window.innerWidth < 768) {
                bar.style.width = `${percent}%`;
                bar.style.height = '100%';
            } else {
                bar.style.height = `${percent}%`;
                bar.style.width = '100%';
            }
        }
        
        // –°–ª—É—à–∞–µ–º —Ä–µ—Å–∞–π–∑ –æ–∫–Ω–∞, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ —ç–∫—Ä–∞–Ω–∞
        window.addEventListener('resize', updateProgress);

        // --- –õ–û–ì–ò–ö–ê –§–ò–ù–ê–õ–ê (TYPEWRITER & CAROUSEL) ---

        // 1. Typewriter (–ú–∞–≥–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ)
        const celebrationText = "–° –Æ–±–∏–ª–µ–µ–º! –ü—É—Å—Ç—å —ç—Ç–∞ –∑–æ–ª–æ—Ç–∞—è –¥–∞—Ç–∞ —Å—Ç–∞–Ω–µ—Ç —Å—Ç–∞—Ä—Ç–æ–º –¥–ª—è —Å–∞–º—ã—Ö —Å–º–µ–ª—ã—Ö –∂–µ–ª–∞–Ω–∏–π. –¢—ã ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –∫—Ä–∞—Å–æ—Ç–∞ –∏ –º—É–¥—Ä–æ—Å—Ç—å. –ú—ã —Ç–µ–±—è –æ—á–µ–Ω—å –ª—é–±–∏–º!";
        let typewriterTimeouts = [];

        function startTypewriter() {
            const el = document.getElementById('typewriter-text');
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ç–∞–π–º–µ—Ä—ã –µ—Å–ª–∏ –µ—Å—Ç—å
            typewriterTimeouts.forEach(t => clearTimeout(t));
            typewriterTimeouts = [];
            
            el.innerHTML = '';
            let i = 0;
            
            function type() {
                if (i < celebrationText.length) {
                    el.innerHTML += celebrationText.charAt(i);
                    i++;
                    const timeout = setTimeout(type, 50); // –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—á–∞—Ç–∏
                    typewriterTimeouts.push(timeout);
                } else {
                    // –£–±–∏—Ä–∞–µ–º –∫—É—Ä—Å–æ—Ä –≤ –∫–æ–Ω—Ü–µ
                    setTimeout(() => el.classList.remove('typewriter-cursor'), 1000);
                }
            }
            type();
        }

        // 2. Carousel (–ö–∞—Ä—É—Å–µ–ª—å –ø–æ–∂–µ–ª–∞–Ω–∏–π)
        function renderWish() {
            const content = document.getElementById('carousel-content');
            const wish = wishes[currentWishIndex];
            
            // –≠—Ñ—Ñ–µ–∫—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            content.style.opacity = 0;
            content.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                content.innerHTML = `
                    <div class="mb-2">
                        <i data-lucide="sparkles" class="w-6 h-6 text-yellow-300 inline-block"></i>
                    </div>
                    <p class="text-white text-lg font-light italic leading-relaxed mb-3">"${wish.text}"</p>
                    <p class="text-pink-300 text-sm font-bold uppercase tracking-wider">‚Äî ${wish.from}</p>
                `;
                lucide.createIcons();
                
                // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è
                content.style.opacity = 1;
                content.style.transform = 'scale(1)';
            }, 300);
        }

        document.getElementById('carousel-prev').addEventListener('click', () => {
            currentWishIndex = (currentWishIndex - 1 + wishes.length) % wishes.length;
            renderWish();
        });

        document.getElementById('carousel-next').addEventListener('click', () => {
            currentWishIndex = (currentWishIndex + 1) % wishes.length;
            renderWish();
        });


        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º (–ì–õ–û–ë–ê–õ–¨–ù–û–ï)
        const btnSound = document.getElementById('btn-sound');
        const iconOn = document.getElementById('icon-sound-on');
        const iconOff = document.getElementById('icon-sound-off');

        btnSound.addEventListener('click', () => {
            isSoundEnabled = !isSoundEnabled;
            if (isSoundEnabled && audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            
            if (isSoundEnabled) {
                iconOn.classList.remove('hidden');
                iconOff.classList.add('hidden');
            } else {
                iconOn.classList.add('hidden');
                iconOff.classList.remove('hidden');
            }
        });

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–∏–Ω–∞–ª—É
        document.getElementById('btn-to-celebration').addEventListener('click', () => {
            showStep('step-celebration');
        });

        // –ö–ù–û–ü–ö–ê "–í –ù–ê–ß–ê–õ–û" (–†–µ—Å—Ç–∞—Ä—Ç)
        document.getElementById('btn-restart').addEventListener('click', () => {
            // –°–±—Ä–æ—Å –≥–∞–ª–µ—Ä–µ–∏
            currentIndex = 0;
            updateProgress();
            
            // –°–±—Ä–æ—Å UI –≥–∞–ª–µ—Ä–µ–∏
            const cardsContainer = document.getElementById('cards-container');
            const finishScreen = document.getElementById('gallery-finish');
            
            cardsContainer.innerHTML = '';
            cardsContainer.style.display = 'block';
            finishScreen.classList.add('hidden');
            finishScreen.classList.remove('flex');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–Ω–æ–≤–∞ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
            const instruction = document.getElementById('gallery-instruction');
            if(instruction) instruction.style.display = 'flex';
            
            const label2025 = document.getElementById('label-2025');
            label2025.className = 'absolute -left-12 md:left-auto md:-top-10 font-bold transition-all duration-500 text-slate-300 text-sm md:text-base';
            document.getElementById('progress-star').classList.remove('fill-purple-600', 'animate-bounce');

            // –°–±—Ä–æ—Å –∫–≤–∏–∑–∞
            currentQuizIndex = 0;
            quizScore = 0;

            // –°–±—Ä–æ—Å –∫–∞—Ä—É—Å–µ–ª–∏
            currentWishIndex = 0;

            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            showStep('step-welcome');
        });

        document.getElementById('secret-gift-btn').addEventListener('click', (e) => {
            e.preventDefault();
            alert("–ó–¥–µ—Å—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–π–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫!");
        });


        // --- 4. –°–ê–õ–Æ–¢ (CANVAS) ---
        function startFireworks() {
            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');
            let width = window.innerWidth;
            let height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            window.addEventListener('resize', () => {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;
            });

            const particles = [];
            const colors = ['#FFD700', '#FF69B4', '#00FFFF', '#FF4500', '#ADFF2F'];

            function createFirework(x, y) {
                if (Math.random() > 0.3) playFireworkSound();

                const count = 60; 
                for (let i = 0; i < count; i++) {
                    particles.push({
                        x: x,
                        y: y,
                        vx: Math.cos((i * 360) / count * Math.PI / 180) * (Math.random() * 5),
                        vy: Math.sin((i * 360) / count * Math.PI / 180) * (Math.random() * 5),
                        alpha: 1,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        decay: Math.random() * 0.015 + 0.01
                    });
                }
            }

            if (fireworksInterval) clearInterval(fireworksInterval);
            fireworksInterval = setInterval(() => {
                createFirework(
                    Math.random() * width, 
                    Math.random() * (height / 2)
                );
            }, 800);

            function loop() {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, width, height);
                ctx.globalCompositeOperation = 'lighter';

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.05; 
                    p.alpha -= p.decay;
                    
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.alpha;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                    ctx.fill();

                    if (p.alpha <= 0) {
                        particles.splice(i, 1);
                    }
                }
                fireworksAnimationFrame = requestAnimationFrame(loop);
            }
            loop();
        }

        function stopFireworks() {
            if (fireworksInterval) clearInterval(fireworksInterval);
            if (fireworksAnimationFrame) cancelAnimationFrame(fireworksAnimationFrame);
            const canvas = document.getElementById('fireworks-canvas');
            if(canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }
    </script>
</body>
</html>